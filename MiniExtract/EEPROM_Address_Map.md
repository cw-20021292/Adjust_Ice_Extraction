# ICON-ICE-2KG EEPROM 주소 맵

## 개요
- **프로젝트**: ICON ICE 2KG MAX (CHPI-7420N)
- **버전**: V1.0.0.9
- **EEPROM 시작 오프셋**: 0x0040
- **체크 값**: 시작=0xAA, 종료=0x55

---

## 전체 메모리 맵

| 섹션 | 시작 주소 | 끝 주소 | 길이 | 설명 |
|------|----------|---------|------|------|
| CHECK_START | 0x0040 | 0x0040 | 1 | EEPROM 유효성 체크 (0xAA) |
| SPECIAL_SETTING | 0x0050 | 0x005F | 16 | 기본 설정 (냉수, 온수, 잠금, 음성 등) |
| ICE_SETTING | 0x0060 | 0x0066 | 7 | 얼음 관련 설정 |
| FUNCTION_SETTING | 0x0070 | 0x007F | 16 | 기능 설정 (절전, UV, 살균 시간 등) |
| ETC_SAVE | 0x0080 | 0x0081 | 2 | 기타 설정 (컵량, 출수 선택) |
| MEMENTO | 0x0090 | 0x0094 | 5 | 에러 히스토리 (최근 5개) |
| IOT_FUNCTION | 0x00A0 | 0x00A9 | 10 | IoT 관련 설정 (컵량, FOTA, 드레인탱크 살균) |
| WATER_USAGE | 0x00B0 | 0x00BC | 13 | 필터 사용량 및 리셋 시간 |
| DEBUG_DATA | 0x00C0 | 0x00C1 | 2 | 디버그 데이터 (살균 중단 카운터) |
| WIFI_DATA | 0x00E0 | 0x00E3 | 4 | WiFi 설정 |
| MY_DATA | 0x00F0 | 0x00FC | 13 | MY 레시피 설정 |
| HOT_TEMP | 0x0100 | 0x0103 | 4 | 온수 온도 선택 설정 |
| CHECK_END | 0x01EA | 0x01EA | 1 | EEPROM 유효성 체크 (0x55) |
| TEST | 0x01EC | 0x01EC | 1 | EEPROM 테스트 영역 |

---

## 1. SPECIAL_SETTING (0x0050 ~ 0x005F)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0050 | [0] | bit | 냉수 기능 ON/OFF | SET (1) | 0~1 |
| 0x0051 | [1] | bit | 온수 잠금 | CLEAR (0) | 0~1 |
| 0x0052 | [2] | bit | 전체 잠금 | CLEAR (0) | 0~1 |
| 0x0053 | [3] | bit | 음소거 설정 | CLEAR (0) | 0~1 |
| 0x0054 | [4] | U8 | 냉수 온도 레벨 (강/약) | COLD_TEMP_HIGH (1) | 0~1 |
| 0x0055 | [5] | bit | 온수 기능 ON/OFF | SET (1) | 0~1 |
| 0x0056 | [6] | bit | 설치 플러싱 상태 | SET (1) | 0~1 |
| 0x0057 | [7] | U8 | 필터 플러싱 상태 | FILTER_FLUSHING_NONE (0) | 0~2 |
| 0x0058 | [8] | bit | 최초 시간 설정 완료 | CLEAR (0) | 0~1 |
| 0x0059 | [9] | U8 | 사운드 타입 (음성/버저) | SOUND_TYPE_VOICE | 0~2 |
| 0x005A | [10] | U8 | 음성 볼륨 레벨 | SOUND_VOLUME_LEVEL_3 (3) | 0~5 |
| 0x005B | [11] | U8 | 고도 설정 | ALTITUDE_1_MODE_HIGH (0) | 0~3 |
| 0x005C | [12] | U8 | 음성 언어 타입 | LANGUAGE_TYPE_ENGLISH | 0~MAX |
| 0x005D | [13] | U8 | CT 강제 플러싱 시작 | CLEAR (0) | 0~1 |
| 0x005E | [14] | U8 | CT 필터 교체 정보 | 0 | 0~7 |

---

## 2. ICE_SETTING (0x0060 ~ 0x0066)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0060 | [0] | bit | 얼음 잠금 | CLEAR (0) | 0~1 |
| 0x0061 | [1] | bit | 얼음 기능 ON/OFF | SET (1) | 0~1 |
| 0x0062 | [2] | bit | 제빙 우선순위 (냉수/얼음) | COLD_FIRST_ICE_MAKE (0) | 0~1 |
| 0x0063 | [3] | U8 | 빠른 제빙 복원 설정 | NEW_FAST_ICE (0) | 0~1 |
| 0x0064 | [4] | U8 | 산세척 복귀 단계 | 0 | 0~14 |
| 0x0065 | [5] | bit | 얼음 크기 (대/소) | 0 | 0~1 |
| 0x0066 | [6] | bit | 얼음 타입 (일반/조각) | CLEAR (0) | 0~1 |

---

## 3. FUNCTION_SETTING (0x0070 ~ 0x007F)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0070 | [0] | bit | 절전 모드 설정 | SET (1) | 0~1 |
| 0x0071 | [1] | bit | 순환 배수 설정 | SET (1) | 0~1 |
| 0x0072 | [2] | bit | 자동 UV 제어 | SET (1) | 0~1 |
| 0x0073 | [3] | bit | 추출 LED ON/OFF | SET (1) | 0~1 |
| 0x0074 | [4] | U8 | 스마트 미사용 시간 (시간) | USE_SAVE_LEARNEND_MODE_TIME | MIN~MAX |
| 0x0075 | [5] | - | 미사용 | - | - |
| 0x0076 | [6] | - | 미사용 | - | - |
| 0x0077 | [7] | bit | 주기 살균 기능 | SET (1) | 0~1 |
| 0x0078 | [8] | U8 | 주기 살균 시간 (시) | WIFI_PERIOD_STER_HOUR_DEFAULT | 0~23 |
| 0x0079 | [9] | U8 | 주기 살균 시간 (분) | WIFI_PERIOD_STER_MINUTE_DEFAULT | 0~59 |
| 0x007A | [10] | bit | 취침 모드 설정 | CLEAR (0) | 0~1 |
| 0x007B | [11] | U8 | 취침 시작 시간 (시) | WIFI_SLEEP_MODE_START_HOUR_DEFAULT | 0~23 |
| 0x007C | [12] | U8 | 취침 시작 시간 (분) | WIFI_SLEEP_MODE_START_MINUTE_DEFAULT | 0~59 |
| 0x007D | [13] | U8 | 취침 종료 시간 (시) | WIFI_SLEEP_MODE_FINISH_HOUR_DEFAULT | 0~23 |
| 0x007E | [14] | U8 | 취침 종료 시간 (분) | WIFI_SLEEP_MODE_FINISH_MINUTE_DEFAULT | 0~59 |
| 0x007F | [15] | bit | 대기 모드 활성화 | WIFI_WAIT_MODE_ENABLE_DEFAULT | 0~1 |

---

## 4. ETC_SAVE (0x0080 ~ 0x0081)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0080 | [0] | U8 | 기본 컵량 레벨 | CUP_LEVEL_1_120ML (1) | 1~5 |
| 0x0081 | [1] | U8 | 기본 출수 선택 (정수/냉수/온수) | PURE_WATER_SELECT | 0~3 |

---

## 5. MEMENTO (0x0090 ~ 0x0094)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0090 | [0] | U8 | 에러 히스토리 1 | 0 | 0~MAX_ERROR(110) |
| 0x0091 | [1] | U8 | 에러 히스토리 2 | 0 | 0~MAX_ERROR(110) |
| 0x0092 | [2] | U8 | 에러 히스토리 3 | 0 | 0~MAX_ERROR(110) |
| 0x0093 | [3] | U8 | 에러 히스토리 4 | 0 | 0~MAX_ERROR(110) |
| 0x0094 | [4] | U8 | 에러 히스토리 5 | 0 | 0~MAX_ERROR(110) |

---

## 6. IOT_FUNCTION (0x00A0 ~ 0x00A9)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x00A0 | [0] | U16 | 반컵 (120ml) 유량 설정 (상위) | DEFAULT_HALF_CUP_AMOUNT | 120~1000 |
| 0x00A1 | [1] | U16 | 반컵 유량 (하위 바이트) | - | - |
| 0x00A2 | [2] | U16 | 한컵 (250ml) 유량 설정 (상위) | DEFAULT_ONE_CUP_AMOUNT | 120~1000 |
| 0x00A3 | [3] | U16 | 한컵 유량 (하위 바이트) | - | - |
| 0x00A4 | [4] | U16 | 두컵 (500ml) 유량 설정 (상위) | DEFAULT_TWO_CUP_AMOUNT | 120~1000 |
| 0x00A5 | [5] | U16 | 두컵 유량 (하위 바이트) | - | - |
| 0x00A6 | [6] | U16 | 네컵 (1000ml) 유량 설정 (상위) | DEFAULT_FOUR_CUP_AMOUNT | 120~1000 |
| 0x00A7 | [7] | U16 | 네컵 유량 (하위 바이트) | - | - |
| 0x00A8 | [8] | U8 | FOTA 시작 플래그 | CLEAR (0) | 0~1 |
| 0x00A9 | [9] | U8 | **드레인탱크 살균 카운터** | 0 | 0~10 |

**주의**: 0x00A9는 V1.0.0.9에서 드레인탱크 살균 주기(6일)를 위한 카운터로 사용됨.

---

## 7. WATER_USAGE (0x00B0 ~ 0x00BC)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x00B0 | [0] | U16 | NEO 필터 사용 수량 (리터, 상위) | 0 | 0~NEO_TOTAL_USAGE_MAX_WATER |
| 0x00B1 | [1] | U16 | NEO 필터 사용 수량 (하위) | 0 | - |
| 0x00B2 | [2] | U16 | RO 필터 사용 수량 (리터, 상위) | 0 | 0~RO_TOTAL_USAGE_MAX_WATER |
| 0x00B3 | [3] | U16 | RO 필터 사용 수량 (하위) | 0 | - |
| 0x00B4 | [4] | U16 | INO 필터 사용 수량 (리터, 상위) | 0 | 0~INO_TOTAL_USAGE_MAX_WATER |
| 0x00B5 | [5] | U16 | INO 필터 사용 수량 (하위) | 0 | - |
| 0x00B6 | [6] | U16 | NEO 필터 리셋 후 시간 (시간, 상위) | 0 | 0~FILTER_RESET_MAX_HOUR__NEO |
| 0x00B7 | [7] | U16 | NEO 필터 리셋 시간 (하위) | 0 | - |
| 0x00B8 | [8] | U16 | RO 필터 리셋 후 시간 (시간, 상위) | 0 | 0~FILTER_RESET_MAX_HOUR__RO |
| 0x00B9 | [9] | U16 | RO 필터 리셋 시간 (하위) | 0 | - |
| 0x00BA | [10] | U16 | INO 필터 리셋 후 시간 (시간, 상위) | 0 | 0~FILTER_RESET_MAX_HOUR__INO |
| 0x00BB | [11] | U16 | INO 필터 리셋 시간 (하위) | 0 | - |
| 0x00BC | [12] | U8 | 필터 교체 타입 | FILTER_CHANGE_TYPE__NEO_INO | 0~FILTER_CHANGE_TYPE__NEO_RO_INO_ALL |

---

## 8. DEBUG_DATA (0x00C0 ~ 0x00C1)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x00C0 | [0] | U8 | 살균 중 드레인 만수위 중단 횟수 | 0 | 0~99 |
| 0x00C1 | [1] | U8 | 살균 중 저수위 중단 횟수 | 0 | 0~99 |

---

## 9. WIFI_DATA (0x00E0 ~ 0x00E3)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x00E0 | [0] | bit | WiFi 전원 ON/OFF | CLEAR (0) | 0~1 |
| 0x00E1 | [1] | bit | WiFi 최초 페어링 완료 | CLEAR (0) | 0~1 |
| 0x00E2 | [2] | bit | WiFi 모듈 FOTA 상태 | CLEAR (0) | 0~1 |
| 0x00E3 | [3] | bit | MCU FOTA 상태 | CLEAR (0) | 0~1 |

---

## 10. MY_DATA (0x00F0 ~ 0x00FC)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x00F0 | [0] | U8 | MY 워터 1 온도 (℃) | 0 | 6,27,45~100(5℃단위) |
| 0x00F1 | [1] | U16 | MY 워터 1 용량 (ml, 상위) | 0 | 90~1000 |
| 0x00F2 | [2] | U16 | MY 워터 1 용량 (하위) | 0 | - |
| 0x00F3 | [3] | U8 | MY 워터 1 사용 여부 | 0 | 0~1 |
| 0x00F4 | [4] | U8 | MY 워터 2 온도 (℃) | 0 | 6,27,45~100(5℃단위) |
| 0x00F5 | [5] | U16 | MY 워터 2 용량 (ml, 상위) | 0 | 90~1000 |
| 0x00F6 | [6] | U16 | MY 워터 2 용량 (하위) | 0 | - |
| 0x00F7 | [7] | U8 | MY 워터 2 사용 여부 | 0 | 0~1 |
| 0x00F8 | [8] | U8 | MY 워터 3 온도 (℃) | 0 | 6,27,45~100(5℃단위) |
| 0x00F9 | [9] | U16 | MY 워터 3 용량 (ml, 상위) | 0 | 90~1000 |
| 0x00FA | [10] | U16 | MY 워터 3 용량 (하위) | 0 | - |
| 0x00FB | [11] | U8 | MY 워터 3 사용 여부 | 0 | 0~1 |
| 0x00FC | [12] | U8 | MY 레시피 기본 선택 | MY_INDEX_RAMEN (0) | 0~5 |

---

## 11. HOT_TEMP (0x0100 ~ 0x0103)

| 주소 | 오프셋 | 타입 | 설명 | 기본값 | 유효 범위 |
|------|--------|------|------|--------|----------|
| 0x0100 | [0] | U8 | 온수 온도 선택 1 | HOT_SET_TEMP____100oC (11) | 0~11 |
| 0x0101 | [1] | U8 | 온수 온도 선택 2 | HOT_SET_TEMP____85oC (8) | 0~11 |
| 0x0102 | [2] | U8 | 온수 온도 선택 3 | HOT_SET_TEMP____70oC (5) | 0~11 |
| 0x0103 | [3] | U8 | 온수 온도 선택 4 | HOT_SET_TEMP____45oC (0) | 0~11 |

**온수 온도 레벨**:
- 0: 45℃, 1: 50℃, 2: 55℃, 3: 60℃, 4: 65℃, 5: 70℃
- 6: 75℃, 7: 80℃, 8: 85℃, 9: 90℃, 10: 95℃, 11: 100℃

---

## 12. 체크 및 테스트 영역

| 주소 | 설명 | 값 |
|------|------|-----|
| 0x0040 | EEPROM 유효성 시작 체크 | 0xAA |
| 0x01EA | EEPROM 유효성 종료 체크 | 0x55 |
| 0x01EC | EEPROM 읽기/쓰기 테스트 영역 | 0xAA/0x55 토글 |

---

## 주요 데이터 타입 및 범위

### 냉수 온도 레벨
- `COLD_TEMP_HIGH` (1): 냉수 강 (5.8~7.5℃)
- `COLD_TEMP_LOW` (0): 냉수 약 (7.0~11.0℃)

### 컵량 레벨
- `CUP_LEVEL_1_120ML` (1): 120ml (반컵)
- `CUP_LEVEL_2_250ML` (2): 250ml (한컵)
- `CUP_LEVEL_3_500ML` (3): 500ml (두컵)
- `CUP_LEVEL_4_1000ML` (4): 1000ml (네컵)
- `CUP_LEVEL_CONTINUE` (5): 연속 추출

### 출수 선택 상태
- `PURE_WATER_SELECT`: 정수
- `COLD_WATER_SELECT`: 냉수
- `HOT_WATER_SELECT`: 온수
- `ICE_WATER_SELECT`: 얼음물

### 필터 타입
- `FILTER_FLUSHING_NONE` (0): 플러싱 없음
- `FILTER_FLUSHING_NEO` (1): NEO 필터 플러싱
- `FILTER_FLUSHING_RO` (2): RO 필터 플러싱

### 사운드 타입
- `SOUND_TYPE_VOICE`: 음성 안내
- `SOUND_TYPE_BEEP`: 버저 소리
- `SOUND_TYPE_MUTE`: 음소거

---

## EEPROM 사용 통계

| 구분 | 사용 바이트 수 | 비율 |
|------|---------------|------|
| SPECIAL_SETTING | 16 | - |
| ICE_SETTING | 7 | - |
| FUNCTION_SETTING | 16 | - |
| ETC_SAVE | 2 | - |
| MEMENTO | 5 | - |
| IOT_FUNCTION | 10 | - |
| WATER_USAGE | 13 | - |
| DEBUG_DATA | 2 | - |
| WIFI_DATA | 4 | - |
| MY_DATA | 13 | - |
| HOT_TEMP | 4 | - |
| **합계** | **92 바이트** | - |

---

## V1.0.0.9 변경사항

### 드레인탱크 살균 카운터 추가 (0x00A9)
- **주소**: `EEPROM_ADDR6_DRAIN_TANK_STER_COUNT` (0x00A9)
- **변수**: `gu8_drain_tank_ster_count`
- **용도**: 드레인탱크 살균 주기 카운터
- **주기**: 트레이 살균 2회당 1회 = 6일에 1회
- **범위**: 0~10
- **비고**: `DRAIN_TANK__STER_CYCLE = 1` (기존 30일 → 6일 변경)

---

## 읽기/쓰기 함수

### 읽기 함수
```c
void EepromSeqRead(U16 mu16Addr, U8 *pData, U8 mu16Length);
```

### 쓰기 함수
```c
void EepromByteWrite(U16 mu16Addr, U8 mu8Data);
void EepromPageWrite(U16 mu16Addr, U8 *pData, U8 mu8len);
```

### 초기화 함수
- `EEPROM_PRIMARY()`: 전원 ON 시 EEPROM 체크 및 로드
- `eeprom_data_load()`: 모든 설정 값 로드
- `eeprom_initial()`: 전체 EEPROM 초기화

---

## 주의사항

1. **EEPROM 수명 관리**
   - 쓰기 횟수 제한: 일반적으로 100,000회
   - 변경 감지 후에만 쓰기 수행 (M9_Data_Save.c)
   - 카운터는 `gu16_eep_cnt`로 추적

2. **데이터 무결성**
   - 시작/종료 체크 값 (0xAA/0x55) 검증
   - 읽기 후 유효 범위 검사 필수
   - 범위 초과 시 기본값으로 복원

3. **인덱스 일치**
   - `gu8_eeprom_wbuf[]` 쓰기 인덱스
   - `gu8_eeprom_rbuf[]` 읽기 인덱스
   - **반드시 동일한 인덱스 사용!**

4. **드레인탱크 살균 카운터** (V1.0.0.9)
   - 주소 0x00A9는 드레인탱크 살균 카운터 전용
   - 트레이 살균 완료 시마다 증가
   - `>= DRAIN_TANK__STER_CYCLE (1)` 시 드레인탱크 살균 실행

---

**문서 버전**: V1.0.0 (2025-01-02)
**프로젝트**: ICON-ICE-2KG (CHPI-7420N)
**기준 펌웨어**: V1.0.0.9 (2025-12-24)
